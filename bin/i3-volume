#! /bin/bash

notify_volume() {
	local value=$(pactl list sinks | grep 'Volume: front-left' | awk '{print $5}' | sed 's/%//')
	local muted=$(pactl list sinks | grep 'Mute' | awk '{print $2}')
	local icon="notification-audio-volume-high"
	if [ "${muted}" = "yes" ]; then
		icon="notification-audio-volume-muted"
	fi

	filled="#"
	empty="-"
	width=40
	filled_width=$(echo "($value*$width)/100" | bc)
	empty_width=$(echo "$width-$filled_width" | bc)
	bar=$(printf "%-${filled_width}s" | tr ' ' "$filled")
	bar+="$(printf "%-${empty_width}s" | tr ' ' "$empty")"

	local text="Volume: ${value}% (muted:${muted})"

	expires="1500"
	opt_use_dunstify=true
	message="${text}
 ${bar}
	"
	if $opt_use_dunstify; then
		dunstify -i "$icon" -t $expires -h int:value:"$value" -h string:synchronous:volume "Volume" "$message" -r 1000
	else
		notify-send -i "$icon" -t $expires -h int:value:"$value" -h string:synchronous:volume "Volume" "$message"
	fi
}

notify_volume
